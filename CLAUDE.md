# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an **Upptime-powered uptime monitoring** repository for CCCP.PS. Upptime uses GitHub Actions for scheduled health checks (every 5 minutes), GitHub Issues for incident tracking, and GitHub Pages for a public status dashboard at https://up.cccp.ps.

## Critical Rule: Only Edit `.upptimerc.yml`

The **only file that should be manually edited** is `.upptimerc.yml`. All other files are auto-generated:

- `.github/workflows/*.yml` â€” regenerated by the Setup CI workflow
- `api/` â€” generated uptime/response-time badge JSON
- `graphs/` â€” generated PNG charts
- `history/` â€” automated check logs and summary data
- `README.md` â€” auto-updated with status tables by Summary CI

Editing `.upptimerc.yml` triggers the Setup CI workflow, which regenerates workflows, templates, and redeploys the site.

## Architecture

```
.upptimerc.yml (config)
    â”‚
    â”œâ”€â†’ Uptime CI (every 5 min) â†’ checks endpoints â†’ writes history/, creates issues on failure
    â”œâ”€â†’ Response Time CI (daily 23:00) â†’ aggregates metrics â†’ writes api/
    â”œâ”€â†’ Graphs CI (daily 00:00) â†’ generates charts â†’ writes graphs/
    â”œâ”€â†’ Summary CI (daily 00:00) â†’ updates README.md
    â”œâ”€â†’ Static Site CI (daily 01:00) â†’ builds Sapper site â†’ deploys to gh-pages â†’ up.cccp.ps
    â”œâ”€â†’ Setup CI (on .upptimerc.yml change) â†’ regenerates all workflows
    â””â”€â†’ Update Template CI (daily) â†’ pulls latest Upptime version
```

## Required GitHub Secrets

- `SECRET_SITE_001` â€” actual URL to monitor (referenced as `$SECRET_SITE_001` in config)
- `GH_PAT` â€” Personal Access Token for git operations (optional, falls back to `github.token`)

## Commit Conventions

Automated commits use emoji prefixes and `[skip ci]` to prevent recursive CI:
- `ðŸŸ©` / `ðŸŸ¥` â€” service status up/down
- `:bento:` â€” data updates (graphs)
- `:card_file_box:` â€” data updates (summary)
- `:pencil:` â€” README updates
- `:arrow_up:` â€” dependency updates

Manual commits use conventional prefixes: `style:`, `chore:`, `feat:`.

## Important Constraints

- Never force-push â€” breaks historical monitoring data
- Never manually edit workflow files â€” they get overwritten by Setup CI
- Upptime version is v1.41.0 â€” updated automatically by the update-template workflow
- The status site is built with Sapper (Svelte) and deployed via `peaceiris/actions-gh-pages`
